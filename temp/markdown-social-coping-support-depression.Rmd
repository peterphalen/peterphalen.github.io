---
title: Specific social supports and social coping behaviors may prevent suicidal ideation in male veterans with mental health difficulties
author: "peter phalen"
date: "4/10/2019"
output: html_document
---

Recent ideation-to-action theories of suicide have hypothesized that social factors are highly relevant to suicidality, which is a theoretical innovation. Since then, there has been quite a bit of research into the exact way in which the stress associated with interpersonal relationships (e.g., thwarted belongingness, perceived burdnesomeness) can contribute to increased suicidality. However, there has been less research into the specific ways in which intact social relationships might function to prevent against suicidality.

In this paper, we use the [Interpersonal Support Evaluation List](http://www.midss.org/sites/default/files/interpersonal_support_evaluation_list_and_scoring_isel.pdf) (ISEL) and the [COPE inventory](http://www.midss.org/sites/default/files/cope.pdf) to test for specific ways in which social relationships might buffer against suicidality in people who are at high risk.
 
```{r, message=FALSE}
library(tidyverse)
library(rstanarm)
library(GGally)
library(corrplot)
```

The sample consists of 50 male veterans diagnosed with depression. 

```{r, message=F}
setwd("/Users/peterphalen/Downloads/JAHNDATA/")
dat <- read_csv("suicide_combined_all.csv")

# restrict to people with complete COPE data
dat <- dat[which(dat$cope_complete == 2),]
```

# 1.0 Preprocessing

We begin by calculating the relevant COPE and ISEL subscales:
```{r}

dat <- within(dat,
              {
                COPE.instrumental.social.support = cope_4 + cope_14 + cope_30 + cope_45
                COPE.emotional.social.support = cope_11 + cope_23 + cope_34 + cope_52
                ISEL.tangible = ISEL_TS
                ISEL.belonging = ISEL_BS
                ISEL.selfesteem = ISEL_SE
                ISEL.appraisal = ISEL_AS
              })

# save subscale names as a vector so we don't have to keep retyping
social.subscales <-   c("COPE.instrumental.social.support",
                        "COPE.emotional.social.support",
                        'ISEL.tangible',
                        "ISEL.belonging", 
                        "ISEL.selfesteem", 
                        "ISEL.appraisal")
```

Create some basic demographic variables.
```{r}
dat <- within(dat,
       {
         marital <- factor(marital, levels=1:4, labels=c("married","widowed","divorced","single"))
         race <- factor(Race, levels=1:7, labels=c("AmerInd","AsianPI","AsianPI","Black","AsianPI","White","Multiple"))
         gender <- factor(male, 0:1, labels=c("female","male"))
       })

```

# 1.1 Descriptive statistics

Check distribution of demographic variables.
```{r, message=FALSE}
demographic.vars <- c("Age",
                      "marital",
                      "yr_edu",
                      "race")

ggpairs(dat[demographic.vars])
```

Collapse people with unreported race (n=1) together with people who have multiple races (n=4).
```{r}
levels(dat$race)[which(levels(dat$race) == "Multiple")] <- "Other"
dat[is.na(dat$race),"race"] <- "Other" 
summary(dat$race)
```


Sample is all male so no point including this as a covariate:
```{r}
summary(dat$gender)
```

Take a look at depression distribution, which we'll also want to include in multivariate analyses.
```{r}
ggplot(dat) + 
  aes(x=FCESD) + # CESD depression
  geom_bar()
```

And anxiety...

```{r}
ggplot(dat) + 
  aes(x=bai_total) + # beck anxiety inventory
  geom_bar()
```

# 2.0 Suicide ideation and coping

Here's the distribution of suicidal ideation in the sample, as measured by the Beck Scale for Suicide Ideation (BSS). About half the sample has some level of suicidal ideation.
```{r}
ggplot(dat) +
  aes(x = BSS_sum) +
  geom_bar()
```

Log-transform of SSI probably makes the most sense--as confirmed by pairs plot farther down (relationships between BSS and subscales are log-linear).
```{r}
dat$BSS_log <- log(dat$BSS_sum + 1)
ggplot(dat) +
  aes(x = BSS_log) +
  geom_bar()
```

## 2.1 Exploratory correlations

We first run correlations between all the COPE subscales and suicide ideation (```BSS_log```). Darker red indicates a more positive correlation. Darker blue indicates more negative. Nonsignificant correlations (p>.05) how have an X drawn over them. (But please remember that [filtering on statistical significance leads to overconfident expectations of replicability](https://arxiv.org/pdf/1702.00556.pdf).)
 
```{r}
# mat : is a matrix of data
# ... : further arguments to pass to the native R cor.test function
cor.mtest <- function(mat, ...) {
    mat <- as.matrix(mat)
    n <- ncol(mat)
    p.mat<- matrix(NA, n, n)
    diag(p.mat) <- 0
    for (i in 1:(n - 1)) {
        for (j in (i + 1):n) {
            tmp <- cor.test(mat[, i], mat[, j], ...)
            p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
        }
    }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}

M<-cor(dat[c(social.subscales,"BSS_log", "FCESD", "bai_total")], use = "pairwise.complete.obs")

# matrix of the p-value of the correlation
p.mat <- cor.mtest(dat[c(social.subscales,"BSS_log", "FCESD", "bai_total")])
corrplot(M, type="lower", order="hclust", 
         col=colorRampPalette(c("darkblue", "white", "darkred"))(100),
         p.mat = p.mat, sig.level = 0.05,
         insig="pch", pch=4, pch.cex=1.5,
         pch.col=rgb(0,0,0,.4))
```

#### Check the most relevant variables

Look at relationship between SI and the statistically significant variables in some more detail.

```{r, message=FALSE,warning=FALSE}

ggpairs(subset(dat, select=c(COPE.instrumental.social.support,
                             COPE.emotional.social.support,
                             ISEL.tangible,
                             ISEL.belonging,
                             ISEL.selfesteem,
                             ISEL.appraisal,
                             BSS_log)),
        lower=list(continuous=wrap("smooth", col=rgb(0,0,0,alpha=.5))))

```

## 2.2 Multivariate analysis

Fit model, z-scoring continuous variables so that coefficients are easily comparable.
```{r}
fit <- stan_lmer(BSS_log ~
                   (1 | marital) +
                   (1 | race ) +
                   # z-score the continuous predictors to put them on a common scale
                   scale(yr_edu) +
                   scale(Age) +
                   scale(FCESD) + 
                   scale(bai_total) +
                   scale(COPE.emotional.social.support) +
                   scale(ISEL.tangible) +
                   scale(ISEL.belonging) +
                   scale(ISEL.selfesteem) +
                   scale(ISEL.appraisal),
                 iter=4000,
                 adapt_delta=.975,
                 cores=4,
                 data=dat)
```

The model accounts for nearly 70% of the variance in suicidal ideation, which is very, very good.

```{r}
r2 <- bayes_R2(fit)
median(r2)
```


Plot parameter estimates with 95% credible intervals and 80% credible intervals shaded.

```{r}
plot(fit, "areas", pars="beta", 
     prob_outer=.95, prob=.8)
```


## 2.3 Interpretation

Let's think about what our model is saying. First of all, it appears that certain social variables may be more strongly associated with suicidality than depression or anxiety. Let's look at some of the subscales in more detail.

#### ISEL-Self-esteem
ISEL-Self-esteem is the strongest predictor of suicidal ideation in our sample--much stronger than depression or anxiety. This subscale is intended to represent "the perceived availability of a positive comparison when comparing one's self to others." Here are all 10 of the items from the scale:

 * Most of my friends are more interesting than I am. (reverse-coded)
 * There is someone who takes pride in my accomplishments.
 * Most people I know think highly of me.
 * I think that my friends feel that Iâ€™m not very good at helping them solve their problems. (reverse-coded)
 * I am as good at doing things as most other people are.
 * In general, people do not have much confidence in me. (reverse-coded)
 * Most of my friends are more successful at making changes in their lives than I am. (reverse-coded)
 * I am more satisfied with my life than most people are with theirs.
 * I am closer to my friends than most other people are to theirs.
 * I have a hard time keeping pace with my friends. (reverse-coded)
 
These are social items but they really zero in on self-esteem. It reads a lot like a measure of depression, albeit through a social lense. It's interesting that the scale predicts suicidality so much better than the CESD. 

Because model coefficients can be hard to interpret, here we create a plot of ISEL-Self-esteem and suicidality, with the model prediction drawn as a line. Remember, this line represents the relationship between ISEL-Self-esteem and suicidality after controlling for other variables in the model constant, including depression.

```{r}

newdata <- data.frame(
  COPE.emotional.social.support = mean(dat$COPE.emotional.social.support),
  FCESD = mean(dat$FCESD),
  bai_total = mean(dat$bai_total),
  ISEL.tangible = mean(dat$ISEL.tangible),
  ISEL.belonging = mean(dat$ISEL.belonging),
  ISEL.selfesteem = 0:30,
  ISEL.appraisal = mean(dat$ISEL.appraisal),
  yr_edu = mean(dat$yr_edu),
  Age = mean(dat$Age),
  race=0,
  marital=0)

pred.BSS_log <- posterior_linpred(fit,
                newdata=newdata,
                re.form=NA)
pred.BSS_log <- apply(pred.BSS_log,2,mean)
preds <- data.frame( ISEL.selfesteem = 0:30,
            BSS_sum = exp(pred.BSS_log )
            )
ggplot(dat) + 
  aes(y=BSS_sum,x=ISEL.selfesteem) + 
  geom_point(alpha=.3) + 
  geom_line(data=preds, col="blue")
```



#### ISEL-Belonging

The ISEL-Belonging subscale is intended to capture "the perceived availability of people one can do things with." It consists of the following 10 items:

* When I feel lonely, there are several people I can talk to.
* I often meet or talk with family or friends.
* I feel like Iâ€™m not always included by my circle of friends. (reverse coded)
* There are several different people I enjoy spending time with.
* If I wanted to go on a trip for a day (e.g., to the mountains, beach, or country), I would have a hard time finding someone to go with me. (reverse coded)
* If I decide one afternoon that I would like to go to a movie that evening, I could easily find someone to go with me.
* Most people I know do not enjoy the same things that I do. (reverse coded)
* I donâ€™t often get invited to do things with others. (reverse coded)
* If I wanted to have lunch with someone, I could easily find someone to join me.
* No one I know would throw a birthday party for me. (reverse coded)

The inverse relationship between ISEL-Belonging and suicidal ideation isn't classically statistically significant, but the model suggests there's a >90% chance that it's real.  

#### ISEL-Tangible

The ISEL-Tangible subscale is intended to capture "perceived availability of material aid." Its zero-order relationship with SI is negative as you would expect, but in the multivariate model it predicts *increased* risk of suicidal ideation after controlling for the other variables. The Tangible subscale consists of the following 10 items:

 * If I needed help fixing an appliance or repairing my car, there is someone who would help me.
 * If I needed a ride to the airport very early in the morning, I would have a hard time finding someone to take me. (reverse coded)
 * If I were sick and needed someone (friend, family member, or acquaintance) to take me to the doctor, I would have trouble finding someone. (reverse coded)
 * If I needed a place to stay for a week because of an emergency (for example, water or electricity out in my apartment or house), I could easily find someone who would put me up.
 * If I were sick, I could easily find someone to help me with my daily chores.
 * If I needed an emergency loan of $100, there is someone (friend, relative, or acquaintance) I could get it from.
 * If I had to go out of town for a few weeks, it would be difficult to find someone who would look after my house or apartment (the plants, pets, garden, etc.). (reverse coded)
 * If I was stranded 10 miles from home, there is someone I could call who would come and get me. 
 * It would be difficult to find someone who would lend me their car for a few hours. (reverse coded)
 * If I needed some help in moving to a new house or apartment, I would have a hard time finding someone to help me. (reverse coded)

It's hard to understand how items like these could predict increased suicidality even after controlling for other items in the model. 

If you remove every other COPE and ISEL variable from the model, ISEL-Tangible predicts decreased suicidality as you would expect. Taking out ISEL-Belonging makes the most difference in this respect, which gives us a better way of understanding the negative relationship between ISEL-Tangible and SI in the multivariate model:

```{r}
ggplot(dat) + 
  aes(x = ISEL.belonging, y = ISEL.tangible) + 
  geom_point() + 
  geom_smooth(method="lm", se=FALSE, col = "black", lty=2) + 
  ggtitle("people scoring above the dotted line tended to have higher suicidal\nideation than people scoring below the dotted line")
```


#### COPE Emotional Social Support

The ```emotional social support``` subscale consists of the following four items:

 * I discuss my feelings with someone
 * I try to get emotional support from friends or relatives
 * I get sympathy and understanding from someone
 * I talk to someone about how I feel

These are the specific kinds of coping strategies that may be associated with decreased suicidality *even after controlling for depression and anxiety.* Not technically classically statistically significant, but it may as well be, as the model excludes zero with >95% probability.

# 3.0 Suicide attempts and coping

The next step is to look at the relationship between COPE subscales and suicide attempts (as opposed to ideation). 

Here's the distribution of suicide attempts in the sample. About 50% have attempted suicide before, and about 20% of the sample has multiple attempts.

```{r}
ggplot(dat) + 
  aes(x = cssrs_12c_total_attempt) +
  geom_bar()
```

Again, it probably makes sense to log-transform. After all, the difference between 0 and 1 suicide attempts is intuitively much greater than the difference between 1 and 2 suicide attempts.

```{r}
dat$attempts_log <- log(dat$cssrs_12c_total_attempt + 1)
ggplot(dat) + 
  aes(x = attempts_log) +
  geom_bar()
```


We first run correlations between all the COPE subscales and suicide attempts. In general, the relationships are weaker than those we measured with suicidal ideation. That's not suprising... The COPE and suicide ideation measures are roughly contemporaneous, whereas distant suicide attempts could have very little relationship with current coping styles.

```{r}
M<-cor(dat[c(social.subscales,"attempts_log", "FCESD", "bai_total")], use = "pairwise.complete.obs")
p.mat <- cor.mtest(dat[c(social.subscales,"attempts_log", "FCESD", "bai_total")])
corrplot(M, type="lower", order="hclust", 
         col=colorRampPalette(c("darkblue", "white", "darkred"))(100),
         p.mat = p.mat, sig.level = 0.05,
         insig="pch", pch=4, pch.cex=1.5,
         pch.col=rgb(0,0,0,.4))
```

None of the correlations between coping styles and suicide attempts are classically statistically significant (log-transforms don't make much difference).

### Does binarizing change anything?

Maybe we're reading too far into the number of suicide attempts... Suicide attempts are common in this sample, but in the general population, *any* history of suicide attempt would make you an outlier. So, we could try treating prior suicide attempts as a binary rather than a continuous variable.

```{r}
dat$prior_attempt <- dat$cssrs_12c_total_attempt > 0
table(dat$prior_attempt)
```

Correlations aren't kosher with binary data, so we run 6 t-tests to see whether people with prior suicide attempts endorse the social subscales to different degrees. However, none of the p-values are anywhere near the mystical .05 cutoff.
```{r, message=FALSE}
t.tests <- lapply(dat[,as.character(social.subscales[1:length(social.subscales)])], function(x) t.test(x ~ dat$prior_attempt, var.equal = TRUE))
# empty data.frame to store p.values
p.values <- data.frame(p.values = 1:length(t.tests))
# fill data.frame with p.values
for(test in 1:length(t.tests)){
  p.values[test,] <- t.tests[[test]]$p.value
}
p.values$empty.factor <- rep("0", times=nrow(p.values))
ggplot(p.values) + 
  aes(x = p.values, y = empty.factor) + 
  geom_point(pch=19, cex=2, alpha=.8) +
  geom_vline(xintercept=.05, col="red") + 
  xlim(0,1) +
  xlab("p-value") +
  theme(axis.ticks.y=element_blank(),
        axis.title.y=element_blank(),
        axis.text.y=element_blank()) + 
  ggtitle("p-values for 6 t-tests, plotted as points", subtitle = ".05 cutoff marked with vertical red line")
```





